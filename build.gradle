plugins {
    id 'com.github.johnrengelman.shadow' version '8.1.+'
    id 'idea'
    id 'java'
    id 'java-library'
}

group = project.base_package
version = project.mod_version

java.toolchain.getLanguageVersion().set(JavaLanguageVersion.of(17))

configurations {
    shade
    implementation.extendsFrom(shade)
    shadow.extendsFrom shade
}

shadowJar {
    //relocate shaded dependencies to the shadow package to prevent library conflicts
    //relocate 'com.moandjiezana.toml', "${shadow_package}.com.moandjiezana.toml"
    //relocate 'org.joml', "${shadow_package}.org.joml"
    configurations = [project.configurations.shadow]
    setArchiveClassifier('')
}

tasks.assemble.dependsOn('shadowJar')

subprojects {
    plugins.apply('idea')
    plugins.apply('java')
    plugins.apply('java-library')

    version = project.mod_version
    group = project.base_package

    repositories {
        mavenCentral()
    }

    dependencies {
        annotationProcessor("org.projectlombok:lombok:${project.lombok_version}")
        compileOnly("org.projectlombok:lombok:${project.lombok_version}")
    }

    java {
        archivesBaseName = project.mod_id
    }

    tasks.withType(JavaCompile).configureEach {
        options.encoding = 'UTF-8'
    }
}